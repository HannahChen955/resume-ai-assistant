FROM n8nio/n8n:latest

USER root

# 安装 Python、pip、Rust（支持解析 PDF/DOCX）
RUN apk update && apk add python3 py3-pip rust cargo \
    && pip install --upgrade pip --break-system-packages

# 先复制 requirements.txt（利用 Docker 缓存）
COPY requirements.txt /home/node/scripts/requirements.txt

# 安装 Python 依赖
RUN pip install --no-cache-dir -r /home/node/scripts/requirements.txt --break-system-packages

# 再复制其他脚本文件
COPY . /home/node/scripts

USER node
